paths:
  /user/register:
    post:
      summary: Register a new user
      description: Registers a new user to the system.
      tags:
        - User
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - user_name
                - role
                - email
                - password
              properties:
                user_name:
                  type: string
                  description: Username for the new user
                  example: johndocon
                role:
                  type: string
                  description: Role of the user in the project (e.g., Developer, Manager)
                  example: Developer
                email:
                  type: string
                  description: Email address of the user
                  example: johndoe@example.com
                password:
                  type: string
                  description: Password for the user account
                  example: password333
            examples:
              example-1:
                summary: Register a new user example
                value:
                  user_name: johndocon
                  role: Developer
                  email: johndoe@example.com
                  password: password333
      responses:
        '201':
          description: User successfully registered and token generated
          content:
            application/json:
              schema:
                type: object
                properties:
                  _id:
                    type: string
                    description: Auto-generated user ID
                    example: "617c1f77f0d4c800170d0f67"
                  user_name:
                    type: string
                    description: Username for the new user
                    example: johndocon
                  role:
                    type: string
                    description: Role of the user
                    example: Developer
                  email:
                    type: string
                    description: Email address of the user
                    example: johndoe@example.com
                  isAdmin:
                    type: boolean
                    description: Indicates if the user has admin rights
                    example: false
        '400':
          description: User already exists or invalid user data
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "User already exists"
              examples:
                user_exists:
                  summary: User already exists example
                  value:
                    success: false
                    message: "User already exists"
                invalid_data:
                  summary: Invalid user data example
                  value:
                    success: false
                    message: "Invalid user data"
        '500':
          description: Server error with error message 
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Server error"
                  error: 
                    type: string
                    description: Detailed error message from the server
                    example: "Error: Cannot connect to database"
              examples: 
                server_error:
                  summary: Server error example
                  value: 
                    success: false
                    message: "Server error"
                    error: "Database connection failed"
      x-buttons:
        - text: Cancel
          onClick: "window.location.reload()" # Cancel button action
        - text: Reset
          onClick: "resetForm()" # Reset button (front-end should define resetForm())
      x-execute-query: true # Show Execute Query button to test API


  /user/login:
    post:
      summary: Login a user
      description: Logs in an existing user and returns a JWT token in a cookie.
      tags:
        - User
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  description: User email address
                  example: johndoe@example.com
                password:
                  type: string
                  description: User password
                  example: password123
            examples:
              example-1:
                summary: Login example
                value:
                  email: johndoe@example.com
                  password: password123
      responses:
        '200':
          description: Successfully logged in
          content:
            application/json:
              schema:
                type: object
                properties:
                  _id:
                    type: string
                    description: Auto-generated user ID
                    example: "617c1f77f0d4c800170d0f67"
                  user_name:
                    type: string
                    description: Username for the user
                    example: johndoe
                  role:
                    type: string
                    description: Role of the user
                    example: Developer
                  email:
                    type: string
                    description: Email address of the user
                    example: johndoe@example.com
                  isAdmin:
                    type: boolean
                    description: Indicates if the user has admin rights
                    example: false
                  isActive:
                    type: boolean
                    description: Account activation status
                    example: true
        '401':
          description: Invalid email or password
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Invalid email or password"
        '403':
          description: Account disabled
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Your account is disabled. Please contact your manager."
        '500':
          description: Server error with error message 
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Server error"
                  error: 
                    type: string
                    description: Detailed error message from the server
                    example: "Error: Cannot connect to database"
              examples: 
                server_error:
                  summary: Server error example
                  value: 
                    success: false
                    message: "Server error"
                    error: "Database connection failed"
      x-buttons:
        - text: Cancel
          onClick: "window.location.reload()" # Cancel button action
        - text: Reset
          onClick: "resetForm()" # Reset button (front-end should define resetForm())
      x-execute-query: true # Show Execute Query button to test API

  /user/change-password:
    put:
      summary: Change user password
      description: Allows a user to change their password. Requires the old password for verification.
      tags:
        - User
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - oldPassword
                - newPassword
              properties:
                oldPassword:
                  type: string
                  description: Current password
                  example: oldpassword123
                newPassword:
                  type: string
                  description: New password
                  example: newpassword456
            examples:
              example-1:
                summary: Change password example
                value:
                  oldPassword: oldpassword123
                  newPassword: newpassword456
      responses:
        '200':
          description: Password updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Password updated successfully"
        '400':
          description: Old password is incorrect
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Old password is incorrect"
        '500':
          description: Server error with error message 
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Server error"
                  error: 
                    type: string
                    description: Detailed error message from the server
                    example: "Error: Cannot connect to database"
              examples: 
                server_error:
                  summary: Server error example
                  value: 
                    success: false
                    message: "Server error"
                    error: "Database connection failed"
      x-buttons:
        - text: Cancel
          onClick: "window.location.reload()" # Cancel button action
        - text: Reset
          onClick: "resetForm()" # Reset button (front-end should define resetForm())
      x-execute-query: true # Show Execute Query button to test API

  /user/logout:
    post:
      summary: Logout a user
      description: Logs out an authenticated user by clearing the JWT token from the cookie.
      tags:
        - User
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Successfully logged out
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "User logged out successfully."
        '401':
          description: Unauthorized - User is not authenticated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Unauthorized - Please log in to continue."
      x-buttons:
        - text: Cancel
          onClick: "window.location.reload()" # Cancel button action
        - text: Reset
          onClick: "resetForm()" # Reset button (front-end should define resetForm())
      x-execute-query: true # Show Execute Query button to test API

  /user/profile:
    put:
      summary: Update user profile
      description: Allows a user to update their profile information.
      tags:
        - User
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_name:
                  type: string
                  description: New username
                  example: johndoe
                role:
                  type: string
                  description: New role
                  example: Developer
            examples:
              example-1:
                summary: Update profile example
                value:
                  user_name: johndoe
                  role: Developer
      responses:
        '200':
          description: Profile updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  _id:
                    type: string
                    description: Auto-generated user ID
                    example: "617c1f77f0d4c800170d0f67"
                  user_name:
                    type: string
                    description: Username for the user
                    example: johndoe
                  role:
                    type: string
                    description: Role of the user
                    example: Developer
                  email:
                    type: string
                    description: Email address of the user
                    example: johndoe@example.com
                  isAdmin:
                    type: boolean
                    description: Indicates if the user has admin rights
                    example: false
        '404':
          description: User not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "User not found"
        '500':
          description: Server error with error message 
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Server error"
                  error: 
                    type: string
                    description: Detailed error message from the server
                    example: "Error: Cannot connect to database"
              examples: 
                server_error:
                  summary: Server error example
                  value: 
                    success: false
                    message: "Server error"
                    error: "Database connection failed"

      x-buttons:
        - text: Cancel
          onClick: "window.location.reload()" # Cancel button action
        - text: Reset
          onClick: "resetForm()" # Reset button (front-end should define resetForm())
      x-execute-query: true # Show Execute Query button to test API

  /user/get-all-info:
    get:
      summary: Get all users
      tags:
        - User (use by Admin)
      description: Retrieve all user information, sorted by creation date in descending order.
      operationId: getAllUsers
      security:
        - bearerAuth: []
      parameters: []
      responses:
        '200':
          description: Successfully retrieved a list of all users.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
              examples:
                success:
                  summary: Example response when users are found
                  value:
                    - _id: "62a8c55bff564f0016a3e99e"
                      user_name: "minhk34434hang"
                      role: "UIIIII"
                      email: "khangk333a1111ng@gmail.com"
                      password: "$2a$10$9WWdnzVe1Hc2IGhjQIKvX.N9IDpkKCQvwcbLXA2WdrIk5EbH7FU5W"
                      isAdmin: false
                      tasks: []
                      isActive: true
                      createdDay: "2024-11-15T13:06:26.885Z"
                      createdAt: "2024-11-15T13:06:26.882Z"
                      updatedAt: "2024-11-15T13:06:26.882Z"
                    - _id: "62a8c55bff564f0016a3e99f"
                      user_name: "John Doe"
                      role: "Manager"
                      email: "johndoe@example.com"
                      password: "$2a$10$abcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcdabcd"
                      isAdmin: true
                      tasks: ["62a8c55bff564f0016a3e99g", "62a8c55bff564f0016a3e99h"]
                      isActive: true
                      createdDay: "2023-01-01T10:00:00Z"
                      createdAt: "2023-01-01T10:00:00Z"
                      updatedAt: "2023-01-10T12:00:00Z"
        '500':
          description: Server error with error message 
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Server error"
                  error: 
                    type: string
                    description: Detailed error message from the server
                    example: "Error: Cannot connect to database"
              examples: 
                server_error:
                  summary: Server error example
                  value: 
                    success: false
                    message: "Server error"
                    error: "Database connection failed"
      x-execute:
        - description: "Execute query to test the API"
          button: "Execute Query"
      x-reset:
        - description: "Reset the input parameters and clear the response"
          button: "Reset"
      x-cancel:
        - description: "Cancel the request and go back"
          button: "Cancel"


  /user/search/{user_name}:
    get:
      summary: Get a user by username
      tags:
        - User (use by Admin)
      description: Retrieve users by their username with case-insensitive matching.
      operationId: getUserByName
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: user_name
          required: true
          schema:
            type: string
          description: The user's username
          x-required: true  # Đánh dấu required với sao đỏ
      responses:
        '200':
          description: Successfully retrieved users with matching usernames.
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
              examples:
                success:
                  summary: Example response when users are found
                  value:
                    - id: "62a8c55bff564f0016a3e99e"
                      name: "John Doe"
                      email: "johndoe@example.com"
                      createdAt: "2023-01-01T10:00:00Z"
                      updatedAt: "2023-01-10T12:00:00Z"
                    - id: "62a8c55bff564f0016a3e99f"
                      name: "Johnny Smith"
                      email: "johnnysmith@example.com"
                      createdAt: "2023-02-03T08:25:00Z"
                      updatedAt: "2023-02-05T09:15:00Z"
        '404':
          description: No users found with that name.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "No users found with that name"
              examples:
                notFound:
                  summary: Example response when no user is found
                  value:
                    message: "No users found with that name"
        '500':
          description: Server error with error message 
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Server error"
                  error: 
                    type: string
                    description: Detailed error message from the server
                    example: "Error: Cannot connect to database"
              examples: 
                server_error:
                  summary: Server error example
                  value: 
                    success: false
                    message: "Server error"
                    error: "Database connection failed"
      x-execute:
        - description: "Execute query to test the API"
          button: "Execute Query"
      x-reset:
        - description: "Reset the input parameters and clear the response"
          button: "Reset"
      x-cancel:
        - description: "Cancel the request and go back"
          button: "Cancel"


  /user/disable-account/{email}:
    put:
      summary: Disable a user account
      description: Disables a user's account by setting `isActive` to false. Only admins can perform this action.
      tags:
        - User (use by Admin)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: email
          required: true
          schema:
            type: string
          description: Email of the account to disable
      responses:
        '200':
          description: Account disabled successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Account of user@example.com has been disabled successfully."
                  User:
                    $ref: '#/components/schemas/User'
              examples:
                success:
                  summary: Example response when account is successfully disabled
                  value:
                    message: "Account of user@example.com has been disabled successfully."
                    User:
                      id: "62a8c55bff564f0016a3e99e"
                      name: "User Name"
                      email: "user@example.com"
                      isActive: false
                      createdAt: "2023-01-01T10:00:00Z"
                      updatedAt: "2023-01-10T12:00:00Z"
        '400':
          description: The account is already disabled.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "This account is already disabled"
              examples:
                alreadyDisabled:
                  summary: Example response when account is already disabled
                  value:
                    message: "This account is already disabled"
        '404':
          description: User not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Disabled user not found"
              examples:
                notFound:
                  summary: Example response when user is not found
                  value:
                    message: "Disabled user not found"
        '403':
          description: Access denied
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Access denied"
              examples:
                accessDenied:
                  summary: Example response when access is denied
                  value:
                    message: "Access denied"
        '500':
          description: Server error with error message
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Server error"
                  error: 
                    type: string
                    description: Detailed error message from the server
                    example: "Error: Cannot connect to database"
              examples: 
                server_error:
                  summary: Server error example
                  value: 
                    success: false
                    message: "Server error"
                    error: "Database connection failed"
      x-execute:
        - description: "Execute query to test the API"
          button: "Execute Query"
      x-reset:
        - description: "Reset the input parameters and clear the response"
          button: "Reset"
      x-cancel:
        - description: "Cancel the request and go back"
          button: "Cancel"



  /user/enable-account/{email}:
    put:
      summary: Enable a user account
      description: Enables a user's account by setting `isActive` to true. Only admins can perform this action.
      tags:
        - User (use by Admin)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: email
          required: true
          schema:
            type: string
          description: Email of the account to enable
      responses:
        '200':
          description: Account enabled successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Account of user@example.com has been enabled successfully."
                  User:
                    $ref: '#/components/schemas/User'
              examples:
                success:
                  summary: Example response when account is successfully enabled
                  value:
                    message: "Account of user@example.com has been enabled successfully."
                    User:
                      id: "62a8c55bff564f0016a3e99e"
                      name: "User Name"
                      email: "user@example.com"
                      isActive: true
                      createdAt: "2023-01-01T10:00:00Z"
                      updatedAt: "2023-01-10T12:00:00Z"
        '400':
          description: The account is already enabled.
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "This account is already enabled"
              examples:
                alreadyEnabled:
                  summary: Example response when account is already enabled
                  value:
                    message: "This account is already enabled"
        '404':
          description: User not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Enabled user not found"
              examples:
                notFound:
                  summary: Example response when user is not found
                  value:
                    message: "Enabled user not found"
        '403':
          description: Access denied
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "Access denied"
              examples:
                accessDenied:
                  summary: Example response when access is denied
                  value:
                    message: "Access denied"
        '500':
          description: Server error with error message
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: "Server error"
                  error: 
                    type: string
                    description: Detailed error message from the server
                    example: "Error: Cannot connect to database"
              examples: 
                server_error:
                  summary: Server error example
                  value: 
                    success: false
                    message: "Server error"
                    error: "Database connection failed"
      x-execute:
        - description: "Execute query to test the API"
          button: "Execute Query"
      x-reset:
        - description: "Reset the input parameters and clear the response"
          button: "Reset"
      x-cancel:
        - description: "Cancel the request and go back"
          button: "Cancel"

  /user/admin/update-user/{email}:
    put:
      summary: Update a user's profile by admin
      description: Allows an admin to update user details, such as username, role, and admin rights.
      tags:
        - User (use by Admin)
      parameters:
        - name: email
          in: path
          description: Email of the user to be updated
          required: true
          schema:
            type: string
            format: email
            example: user@example.com
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_name:
                  type: string
                  description: New username for the user
                  example: johndocon
                role:
                  type: string
                  description: New role of the user
                  example: Manager
                isAdmin:
                  type: boolean
                  description: Indicates if the user should have admin rights
                  example: true
            examples:
              update-role:
                summary: Update user role and admin status
                value:
                  user_name: johndocon
                  role: Manager
                  isAdmin: true
      responses:
        '200':
          description: User successfully updated
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Success message
                    example: "User updated successfully!"
                  user:
                    type: object
                    properties:
                      _id:
                        type: string
                        description: User's unique ID
                        example: "617c1f77f0d4c800170d0f67"
                      user_name:
                        type: string
                        description: Updated username
                        example: johndocon
                      role:
                        type: string
                        description: Updated role
                        example: Manager
                      email:
                        type: string
                        description: Email of the user
                        example: user@example.com
                      isAdmin:
                        type: boolean
                        description: Indicates if the user has admin rights
                        example: true
                      isActive:
                        type: boolean
                        description: Indicates if the user account is active
                        example: true
                      createdDay:
                        type: string
                        description: The date when the user account was created
                        format: date
                        example: "2023-01-01"
        '404':
          description: User not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "User not found"
              examples:
                not-found:
                  summary: User not found example
                  value:
                    message: "User not found"
        '500':
          description: Server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Error message
                    example: "Server error"
                  error:
                    type: string
                    description: Detailed error message
                    example: "Cannot connect to the database"
              examples:
                server-error:
                  summary: Server error example
                  value:
                    message: "Server error"
                    error: "Database connection failed"
      x-execute:
        - description: "Execute query to test the API"
          button: "Execute Query"
      x-reset:
        - description: "Reset the input parameters and clear the response"
          button: "Reset"
      x-cancel:
        - description: "Cancel the request and go back"
          button: "Cancel"

  /user/delete/{email}:
    delete:
      summary: Permanently delete a user account
      description: Allows an admin to delete a user account permanently by their email.
      tags:
        - User (use by Admin)
      parameters:
        - name: email
          in: path
          description: Email of the user account to be deleted
          required: true
          schema:
            type: string
            format: email
            example: user@example.com
      responses:
        '200':
          description: User account successfully deleted
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Success message
                    example: "User account permanently deleted"
                  userAccount:
                    type: object
                    description: Details of the deleted user account
                    properties:
                      _id:
                        type: string
                        description: Unique user ID
                        example: "617c1f77f0d4c800170d0f67"
                      user_name:
                        type: string
                        description: User's name
                        example: johndocon
                      role:
                        type: string
                        description: Role of the user
                        example: Manager
                      email:
                        type: string
                        description: Email of the user
                        example: user@example.com
                      isAdmin:
                        type: boolean
                        description: Indicates if the user had admin rights
                        example: false
                      isActive:
                        type: boolean
                        description: Indicates if the account was active
                        example: true
                      createdDay:
                        type: string
                        description: The date when the account was created
                        format: date
                        example: "2023-01-01"
        '404':
          description: User account not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Error message
                    example: "User account not found !"
              examples:
                account-not-found:
                  summary: Account not found example
                  value:
                    message: "User account not found !"
        '500':
          description: Server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    description: Error message
                    example: "Server error"
                  error:
                    type: string
                    description: Detailed error message
                    example: "Cannot connect to the database"
              examples:
                server-error:
                  summary: Server error example
                  value:
                    message: "Server error"
                    error: "Database connection failed"
      x-execute:
        - description: "Execute query to test the API"
          button: "Execute Query"
      x-reset:
        - description: "Reset the input parameters and clear the response"
          button: "Reset"
      x-cancel:
        - description: "Cancel the request and go back"
          button: "Cancel"



components:
  schemas:
    User:
      type: object
      properties:
        _id:
          type: string
          description: Auto-generated user ID
        user_name:
          type: string
          description: The username
          example: johndoe
        role:
          type: string
          description: Role of the user in the project
          example: Developer
        email:
          type: string
          description: User email address
          example: johndoe@example.com
        password:
          type: string
          description: User password (hashed)
          example: password123
        isAdmin:
          type: boolean
          description: Determines if the user is an admin
          example: false
        isActive:
          type: boolean
          description: Is the account active?
          example: true
        tasks:
          type: array
          items:
            type: string
            description: Task IDs assigned to the user
        createdDay:
          type: string
          format: date-time
          description: Date when the account was created

